<html>
  <head>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="../build/linked-charts.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../build/linked-charts.css">
    <script src = '../build/input_data_2.js'></script>
  </head>
  
    <table>
      <tr>
        <td id = "heatmap" valign="top"></td>
        <td id = "scatterplot" valign="top"></td>
      </tr>
    </table>
  
  <script>


inputData = lc.separateBy(inputData, ["screen", "Drug", "CellLine"]);
  var drugs = Object.keys(inputData.RTG),
    cellLines = Object.keys(inputData.RTG[drugs[0]]);

  var selDrugs = [drugs[0], drugs[1]], 
    selCellLine = cellLines[0];

  var heatmap = lc.heatmapChart()
    .rowIds( drugs )
    .colIds( drugs )
    .value( function( rowId, colId ) {  
      var rowValues = cellLines.map(function(e) {
          return inputData.RTG[rowId][e].avInh;
        }),
        colValues = cellLines.map(function(e) {
          return inputData.RTG[colId][e].avInh;
        });
      return lc.pearsonCorr( rowValues, colValues ); 
     })
    .on_click(function(rowGene, colGene)
    {
      selDrugs = [rowGene, colGene];
      scatterplot.update();
    })
    .place( "#heatmap");

  heatmap.cluster("Row")
    .cluster("Col");

  var scatterplot = lc.scatterChart()
    .dataIds( cellLines )
    .x( function( k ) { return inputData.RTG[selDrugs[0]][k].avInh } )
    .y( function( k ) { return inputData.RTG[selDrugs[1]][k].avInh } )
    .on_click( function( k ) {
    selCellLine = k;
    curveFit.update();
      })
    .place( "#scatterplot" );

  var curveFit = lc.scatterChart("drug1")
    .npoints( 5 )
    .x( function( k ) {return k;} )
    .y( function( k ) {
      return inputData.RTG[selDrugs[0]][selCellLine]["D" + (k + 1)];
    })
    .colour( "blue" );
  lc.scatterChart("drug2", curveFit)
    .npoints( 5 )
    .x( function( k ) {return k} )
    .y( function( k ) {
      return inputData.RTG[selDrugs[1]][selCellLine]["D" + (k + 1)];
    })
    .colour("red")
    .place('#scatterplot')

  </script>
</html>