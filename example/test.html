<html><title>Linked charts with D3</title>

<body>

<div id="main_scatter_plot"></div>
<p id="extra_info"></p>

<script src="../build/d3-linked-charts.js"></script>
<script src="mtcars.json.js">></script>

<script>


// Simple Table

function simpleTable() {

  obj = d3.chartBase()
    .add_property( "record", {} )

  obj.put_static_content = function( element ) {
    obj.table = element.append( "table" )
      .attr( "border", 1 );
  }

  obj.update = function( ) {

    var sel = obj.table.selectAll( "tr" )
      .data( Object.keys( obj.get_record() ) );
    sel.exit()
      .remove();  
    sel.enter().append( "tr" )
    .merge( sel )
      .html( function(k) { return "<td>" + k + "</td><td>" 
         + obj.get_record()[k] + "</td>" } )

    return obj;
  };

  return obj;
}

// User code


if( true ) {

  // Test code 1

  var highlighted = 0;

  var sc = d3.scatterChart()
    .x( function(i) { return data[i].wt } )
    .y( function(i) { return data[i].hp } )
    .style( function(i) { return i==highlighted ? "fill:red" : "" } )
    .x_label( "weight" )
    .y_label( "horsepower" )
    .place( )

  var tbl = simpleTable()
    .record( function() { return data[highlighted] } )
    .place( );

  sc.on_click( function(k) { 
    highlighted = k;
    sc.update();
    tbl.update();
  } )

  data = data.filter( function(x) { return x.hp < 300 } )

  setTimeout( function() { sc.update() }, 2000 );

} else {

  // Test code 2

  data2 = {}
  for( var i = 0; i < data.length; i++ )
    data2[ data[i]._row ] = data[i];
  
  var sc = scatterChart()
    .dataIds( function() { return Object.keys(data2) } )
    .x( function(k) { return data2[k].wt } )
    .y( function(k) { return data2[k].hp } )
    .place( "#main_scatter_plot" )

  data2
  
}

// Not yet used:

// function cache( f ) {
//   var the_cache = {}
//   return function( arguments ) {
//     if( arguments[0] === "clear" ) {
//       the_cache = {}
//       return undefined;
//     }
//     if( !( x in keys(the_cache) ) )
//       the_cache[x] = f.apply( undefined, x );
//     return the_cache[x];
//   }
// }

</script>

</body></html>