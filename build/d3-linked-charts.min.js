!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.d3=t.d3||{})}(this,function(t){"use strict";function e(){var t={};return t.add_property=function(e,a){var r="get_"+e;return t[e]=function(a){if(void 0===a)throw"No value passed in setter for property '"+e+"'.";return t[r]="function"==typeof a?a:function(){return a},t},t[r]="function"==typeof a?a:function(){return a},t},t.put_static_content=function(){},t.place=function(e){if(void 0===e&&(e="body"),"string"==typeof e&&(e=l(e),0==e.size))throw"Error in function 'place': DOM selection for string '"+node+"' did not find a node.";return t.put_static_content(e),t.update(),t},t}function a(){var t=e().add_property("width",500).add_property("height",400).add_property("margin",{top:20,right:10,bottom:20,left:10});return t.put_static_content=function(e){t.real_svg=e.append("svg"),t.svg=t.real_svg.append("g")},t.update=function(){return t.real_svg.attr("width",t.get_width()+t.get_margin().left+t.get_margin().right).attr("height",t.get_height()+t.get_margin().top+t.get_margin().bottom),t.svg.attr("transform","translate("+t.get_margin().left+","+t.get_margin().top+")"),t},t}function r(){var t=e();return t.put_static_content=function(e){t.real_div=e.append("div")},t}function n(){var t=a().add_property("x").add_property("y").add_property("style","").add_property("numPoints").add_property("dataIds");t.add_property("x_label","").add_property("y_label","").add_property("on_click",function(){}),t.margin({top:20,right:20,bottom:30,left:40}),t.dataIds(function(){return d3.range(t.get_numPoints())}),t.numPoints(function(){for(var e,a=0;1e4>a;a++){try{e=t.get_x(a)}catch(r){return a>0?a-1:0}if(void 0===e)return a>0?a-1:0}throw"There seem to be very many data points. Please supply a number via 'numPoints'."});var e=t.put_static_content;t.put_static_content=function(a){e(a),t.axes={},t.axes.x_g=t.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+t.get_height()+")"),t.axes.x_label=t.axes.x_g.append("text").attr("class","label").attr("fill","black").style("text-anchor","end"),t.axes.y_g=t.svg.append("g").attr("class","y axis"),t.axes.y_label=t.axes.y_g.append("text").attr("class","label").attr("fill","black").attr("transform","rotate(-90)").style("text-anchor","end")};var r=t.update;return t.update_not_yet_called=!0,t.update=function(){r();var e=d3.transition();t.update_not_yet_called?(t.update_not_yet_called=!1,e.duration(0)):e.duration(1e3);var a=d3.scaleLinear().domain(d3.extent(t.get_dataIds(),function(e){return t.get_x(e)})).range([0,t.get_width()]).nice(),n=d3.scaleLinear().domain(d3.extent(t.get_dataIds(),function(e){return t.get_y(e)})).range([t.get_height(),0]).nice();d3.axisBottom().scale(a)(t.axes.x_g.transition(e)),d3.axisLeft().scale(n)(t.axes.y_g.transition(e)),t.axes.x_label.attr("x",t.get_width()).attr("y",-6).text(t.get_x_label()),t.axes.y_label.attr("y",6).attr("dy",".71em").text(t.get_y_label());var o=t.svg.selectAll("circle.datapoint").data(t.get_dataIds());return o.exit().remove(),o.enter().append("circle").classed("datapoint",!0).attr("r",3).merge(o).on("click",t.get_on_click).transition(e).attr("cx",function(e){return a(t.get_x(e))}).attr("cy",function(e){return n(t.get_y(e))}).attr("style",function(e){return t.get_style(e)}),t},t}function o(){var t=r().add_property("nrows").add_property("ncols").add_property("value");t.add_property("mode","default").add_property("height",1e3).add_property("width",1e3).add_property("margin",{top:100,bottom:50,left:100,right:20}).add_property("colLabels",function(t){return t}).add_property("rowLabels",function(t){return t}).add_property("colIds",function(){return d3.range(t.get_ncols())}).add_property("rowIds",function(){return d3.range(t.get_nrows())}).add_property("colour",function(e){return t.colourScale(e)}).add_property("heatmapRow",function(t){return t}).add_property("heatmapCol",function(t){return t}).add_property("palette",["#0000FF","#002FFF","#005FFF","#008FFF","#00BFFF","#3FCFFF","#7FDFFF","#BFEFFF","#FFFFFF","#FDFDF3","#FCFCE8","#FBFBDD","#FAFAD2","#F7DBBD","#F4BDA9","#F29E94","#F08080","#F35F5F","#F74040","#FB1F1F","#FF0000"]),t.dataRange=function(){var e,a,r=0;do a=d3.extent(t.get_colIds(),function(e){return t.get_value(t.get_rowIds()[r],e)}),"undefined"==typeof e&&(e=a),a[0]<e[0]&&(e[0]=a[0]),a[1]>e[1]&&(e[1]=a[1]),r++;while(r<t.get_nrows());return e},t.resetColourScale=function(){t.colourScale=d3.scaleQuantile().domain(t.dataRange()).range(t.get_palette())};var e=t.put_static_content;return t.put_static_content=function(a){e(a),t.real_div.style("position","relative"),t.svg=t.real_div.append("svg"),t.svg.append("g").attr("class","row label_panel"),t.svg.append("g").attr("class","col label_panel"),t.svg.append("g").attr("class","legend_panel"),t.resetColourScale()},t.update_not_yet_called=!0,t.updateSVG=function(e,a){t.svg.selectAll("canvas").remove();var r=t.svg.selectAll(".heatmap_body").data(["x"]);r.enter().append("g").attr("class","heatmap_body").merge(r).transition(a).attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),r=t.svg.select(".heatmap_body");var n=r.selectAll(".data_row").data(t.get_rowIds());n.exit().remove(),n.enter().append("g").attr("class","data_row").merge(n).transition(a).attr("transform",function(a){return"translate(0, "+t.get_heatmapRow(a)*e.height+")"});var o=r.selectAll(".data_row").selectAll(".data_point").data(function(e){return t.get_colIds().map(function(t){return[e,t]})});o.exit().remove(),o.enter().append("rect").attr("class","data_point").attr("width",e.width).attr("height",e.height).merge(o).transition(a).attr("x",function(a){return t.get_heatmapCol(a[1])*e.width}).attr("fill",function(e){return t.get_colour(t.get_value(e[0],e[1]))})},t.updateCanvas=function(){t.svg.selectAll(".heatmapBody").remove(),t.svg.selectAll("canvas").remove();var e=t.real_div.append("canvas").style("position","absolute").style("left",t.get_margin().left+"px").style("top",t.get_margin().top+"px").property("width",t.get_width()).property("height",t.get_height()).node().getContext("2d"),a=document.createElement("canvas");a.width=t.get_ncols(),a.height=t.get_nrows();for(var r,n,o=new ImageData(t.get_ncols(),t.get_nrows()),l=0;l<t.get_rowIds().length;l++)for(var d=0;d<t.get_colIds().length;d++)r=d3.rgb(t.get_colour(t.get_value(t.get_rowIds()[l],t.get_colIds()[d]))),n=t.get_heatmapRow(t.get_rowIds()[l])*t.get_ncols()*4+4*t.get_heatmapCol(t.get_colIds()[d]),o.data[n]=r.r,o.data[n+1]=r.g,o.data[n+2]=r.b;for(var l=0;l<t.get_ncols()*t.get_nrows();l++)o.data[4*l+3]=255;a.getContext("2d").putImageData(o,0,0),e.imageSmoothingEnabled=!1,e.drawImage(a,0,0,t.get_colIds().length,t.get_rowIds().length,0,0,t.get_width(),t.get_height())},t.updateSVGTest=function(e,a){t.svg.selectAll("canvas").remove();var r=t.svg.selectAll(".heatmap_body").data(["x"]);r.enter().append("g").attr("class","heatmap_body").merge(r).transition(a).attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),r=t.svg.select(".heatmap_body");var n,o;r.selectAll(".datapoint").classed("transient",!0);for(var l=0;l<t.get_rowIds().length;l++)for(var d=0;d<t.get_colIds().length;d++)n="c"+t.get_rowIds()[l]+"_"+t.get_colIds()[d],o=r.select("#"+n).transition(a),o.empty()&&(o=r.append("rect").attr("id",n).attr("class","cell datapoint").attr("width",e.width).attr("height",e.height)),o.transition(a).attr("x",t.get_heatmapCol(t.get_colIds()[d])*e.width).attr("y",t.get_heatmapRow(t.get_rowIds()[l])*e.height).attr("fill",t.get_colour(t.get_value(t.get_rowIds()[l],t.get_colIds()[d]))),o.classed("transient",!1);r.selectAll(".datapoint").filter(function(){return d3.select(this).classed("transient")}).remove()},t.update=function(){var e;t.update_not_yet_called?(e=d3.transition(0),t.update_not_yet_called=!1):e=d3.transition(1e3),t.real_div.transition(e).style("width",t.get_width()+t.get_margin().left+t.get_margin().right+"px").style("height",t.get_height()+t.get_margin().top+t.get_margin().bottom+"px"),t.svg.transition(e).attr("height",t.get_height()+t.get_margin().top+t.get_margin().bottom).attr("width",t.get_width()+t.get_margin().left+t.get_margin().right),t.svg.selectAll(".label_panel").transition(e).attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),t.svg.select(".legend_panel").transition(e).attr("transform","translate("+t.get_margin().left+", "+(t.get_height()+t.get_margin().top)+")");var a={width:t.get_width()/t.get_ncols(),height:t.get_height()/t.get_nrows()},r=t.svg.select(".col").selectAll(".label").data(t.get_colIds());r.exit().remove(),r.enter().append("text").attr("class","label").attr("transform","rotate(-90)").style("text-anchor","start").merge(r).transition(e).attr("font-size",a.width).attr("dy",function(e){return a.width*(t.get_heatmapCol(e)+1)}).attr("dx",2).text(function(e){return t.get_colLabels(e)});var n=t.svg.select(".row").selectAll(".label").data(t.get_rowIds());n.exit().remove(),n.enter().append("text").attr("class","label").style("text-anchor","end").merge(n).transition(e).attr("font-size",a.height).attr("dy",function(e){return a.height*(t.get_heatmapRow(e)+1)}).attr("dx",-2).text(function(e){return t.get_rowLabels(e)});var o=(t.colourScale.domain()[1]-t.colourScale.domain()[0])/(t.get_palette().length-1),l=[],d=20,i=10;d*t.get_palette().length>t.get_width()&&(d=t.get_width()/t.get_palette().length);for(var s=0;s<t.get_palette().length;s++)l.push((t.colourScale.domain()[0]+s*o).toPrecision(2));var g=t.svg.select(".legend_panel").selectAll(".legend").data(l);if(g.enter().append("g").attr("class","legend").attr("num",function(t,e){return e}),g=t.svg.select(".legend_panel").selectAll(".legend"),g.append("rect"),g.append("text"),g.attr("transform",function(t,e){return"translate("+d*e+", 0)"}),g.selectAll("rect").attr("y",1.2*i).attr("width",d).attr("height",i).attr("fill",function(){return t.colourScale(d3.select(this.parentNode).datum())}),g.selectAll("text").text(function(){return d3.select(this.parentNode).attr("num")%2==0?d3.select(this.parentNode).datum():void 0}).attr("dy",4*i).attr("font-size",d3.min([1.5*i-1,1.5*d])),"default"==t.get_mode()&&t.mode(t.get_ncols*t.get_nrows>5e3?"canvas":"svg"),"canvas"==t.get_mode())return t.updateCanvas(a),t;if("svg"==t.get_mode())return t.updateSVG(a,e),t;if("svg_test"==t.get_mode())return t.updateSVGTest(a,e),t;throw"Error in function 'heatmapChart.update': mode did not correspond to any existing type ('canvas', 'svg' or 'default')"},t}var l=d3.select;t.chartBase=e,t.svgChartBase=a,t.divChartBase=r,t.scatterChart=n,t.heatmapChart=o,Object.defineProperty(t,"__esModule",{value:!0})});